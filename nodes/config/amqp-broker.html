<script type="text/javascript">
  RED.nodes.registerType('amqp-broker', {
    category: 'config',
    color: '#43b53f',
    icon: 'knot.svg',
    defaults: {
      name: { value: '' },
      protocol: { value: 'amqp', required: true },
      hostname: { value: '', required: true },
      port: { value: 5672, required: true },
      username: { value: 'knot' },
      password: { value: 'knot' },
      token: { value: '', required: true },
    },
    label: function () {
      const credentials = `${this.username}:${this.password}`.replace(/:$/, '');
      const url = `${this.protocol}://${credentials}@${this.hostname}:${this.port}`;
      return this.name || url;
    },
  });
</script>

<script type="text/html" data-template-name="amqp-broker">
  <style>
    #node-config-input-hostname {
      width: 45%;
    }

    #node-config-input-port {
      width: 13%;
    }

    .node-config-input-port-label {
      box-sizing: border-box;
      padding-right: 0.3rem;
      text-align: right;
    }
  </style>
  <div class="form-row">
    <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-config-input-name">
  </div>
  <div class="form-row">
    <label for="node-config-input-hostname"><i class="fa fa-globe"></i> Server</label>
    <input type="text" id="node-config-input-hostname" placeholder="e.g. localhost">
    <label for="node-config-input-port" class="node-config-input-port-label" style="width:3.5rem;"> Port</label>
    <input type="text" id="node-config-input-port">
  </div>
  <div class="form-row">
    <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
    <input type="text" id="node-config-input-username">
  </div>
  <div class="form-row">
    <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
    <input type="text" id="node-config-input-password">
  </div>
  <div class="form-row">
    <label for="node-config-input-token"><i class="fa fa-key"></i> Token</label>
    <input type="text" id="node-config-input-token">
  </div>
</script>

<script type="text/html" data-help-name="amqp-broker">
  <p>This node configures the AMQP connection with KNoT RabbitMQ broker</p>
</script>
